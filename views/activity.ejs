<%- include('includes/loggedin-top.ejs') %>
<%- include('includes/date.ejs') %>

	<% if(notification) { %>
		<div class='w-5/6 self-center alert alert-<%= notification.class %> mb-3 z-10'>
			<i class="fa fa-<%= notification.class === 'danger' ? 'exclamation-circle' : 'check-circle' %>"></i> <%= notification.message %>
		</div>
	<% } %>

	<div class='w-5/6 self-center z-10'>
		<p class='csrf__token hidden'><%= csrfToken %></p>
		<div class='bg-white border border-color-005 flex flex-row items-center p-4 mb-3 relative'>
			<img src="/<%= activity.imageUrl %>" alt='<%= activity.name %>' class='object-cover w-16 h-16 rounded mr-5'>
			<div class='flex flex-col'>
				<p class='m-0 mb-2 font-semibold'><%= activity.name %></p>
				<p class='m-0 mb-1 text-sm text-gray-700'><%= activity.description %></p>
				<p class='m-0 text-gray-700 text-sm'><%= activity.milestones.length %> milestones</p>
				<p class='text-xs absolute bottom-0 right-0 mb-2 mr-2 text-gray-600'> <%= getDateString(activity.created_at) %> </p>
			</div>
		</div>
		<div class='flex flex-row items-end mb-4'>
			<a href="#" class='underline text-sm baloo-bhaina text-gray-800 mr-3 ml-1 add__milestone'>Add Milestone</a>
			<a href="/edit/activity/<%= activity._id %>" class='underline text-sm baloo-bhaina text-gray-800 mr-3'>Edit</a>
			<form action='/delete/activity/<%= activity._id %>?_csrf=<%= csrfToken %>' method='POST'>
				<button type='submit' class='bg-transparent underline text-sm baloo-bhaina text-gray-800 focus:outline-none'>Delete</button>
			</form>
		</div>

		<div>
			<% activity.milestones.reverse().forEach(milestone => { %>

				<div class='p-4 flex flex-row items-center bg-white border border-color-005 mb-2 relative group'>
					<img src="/<%= milestone.imageUrl %>" class='object-cover w-12 h-12 rounded mr-5 milestone__image'>
					<p class='m-0 text-gray-600 text-sm mr-2 milestone__description' style='width:75%'>
						<%= milestone.description %>
					</p>
					<p class='milestone__id hidden'><%= milestone._id %></p>
					<div class='transition-all duration-300 ease-in absolute hidden flex-row top-0 right-0 h-full flex flex-row items-center mr-2 group-hover:flex'>
						<i class='fas fa-edit text-xs text-gray-600 mr-3 cursor-pointer'></i>
						<form action='/delete/milestone/<%= milestone._id %>?_csrf=<%= csrfToken %>' method='POST'>
							<button type='submit' class='focus:outline-none w-6 h-6 rounded-md flex flex-row justify-center items-center' style='background:rgba(0,0,0,0.03)'><i class='fas fa-trash text-xs text-gray-600'></i></button>
						</form>
					</div>
				</div>
				<p class='text-xs mb-2 text-gray-600 text-right pr-2'> <%= getDateString(milestone.created_at) %> </p>
			<% }) %>
		</div>
	</div>

	<div class='transition-all ease-in duration-500 fixed top-0 left-0 h-screen w-screen z--9999 flex flex-row justify-center items-center opacity-0 add__milestone__container' style='background:rgba(0,0,0,0.85)'>

		<div class='bg-white relative rounded-md flex flex-col border border-color-005 pb-3' style='width:400px;top:-10vh;'>
			<div class='flex flex-row justify-between items-center p-4 pb-3 pr-6 border-color-005 border-b'>
				<p class='m-0 baloo-bhaina mt-1'>New Milestone - <%= activity.name %> </p>
			</div>
			<form  action='/create/milestone/<%= activity._id %>?_csrf=<%= csrfToken %>' method='POST' class='py-3 px-5' enctype='multipart/form-data'>
				<div class='flex flex-row items-end mb-3'>
					<img src="" class='rounded-md w-0 h-8 object-cover milestone__preview'>
					<div>
						<a href="#" class='underline text-gray-700 baloo-bhaina milestone__trigger'>add image</a>
					</div>
					<input type="file" name="image" class='hidden milestone__file__input'>
				</div>
				<textarea rows='4' name='description' class='border-color-005 border w-full p-2 focus:outline-none text-sm text-gray-600'></textarea>
				<div class='flex flex-row baloo-bhaina text-gray-700 mt-2'>
					<div class='mr-3'>
						<button type='submit' class='underline cursor-pointer focus:outline-none'>create</button>
					</div>
					<div>
						<button type='button' class='underline cursor-pointer focus:outline-none close'>close</button>
					</div>
				</div>
			</form>
		</div>
	</div>

	<div class='transition-all ease-in duration-500 fixed top-0 left-0 h-screen w-screen z--9999 flex flex-row justify-center items-center opacity-0 edit__milestone__container' style='background:rgba(0,0,0,0.85)'>

		<div class='bg-white relative rounded-md flex flex-col border border-color-005 pb-3' style='width:400px;top:-10vh;'>
			<div class='flex flex-row justify-between items-center p-4 pb-3 pr-6 border-color-005 border-b'>
				<p class='m-0 baloo-bhaina mt-1'>Edit Milestone</p>
			</div>
			<form  action='/edit/milestone/<%= activity._id %>?_csrf=<%= csrfToken %>' method='POST' class='py-3 px-5' enctype='multipart/form-data'>
				<div class='flex flex-row items-end mb-3'>
					<img src="" class='rounded-md w-12 h-12 mr-3 object-cover milestone__preview'>
					<div>
						<a href="#" class='underline text-gray-700 baloo-bhaina milestone__trigger'>change image</a>
					</div>
					<input type="file" name="image" class='hidden milestone__file__input'>
				</div>
				<textarea rows='4' name='description' class='border-color-005 border w-full p-2 focus:outline-none text-sm text-gray-600'></textarea>
				<div class='flex flex-row baloo-bhaina text-gray-700 mt-2'>
					<div class='mr-3'>
						<button type='submit' class='underline cursor-pointer focus:outline-none'>update</button>
					</div>
					<div>
						<button type='button' class='underline cursor-pointer focus:outline-none close'>close</button>
					</div>
				</div>
			</form>
		</div>
	</div>
<%- include('includes/loggedin-end.ejs') %>
